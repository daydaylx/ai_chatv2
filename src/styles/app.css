/* =========================================
   Noir Pro – Application Layer Styles
   - keine Logik-Änderungen
   - neue Optik inkl. Markdown, Toaster, Skeleton
   ========================================= */

/* ----- Reset & Base ----- */
*,*::before,*::after{box-sizing:border-box}
html,body,#root{height:100%}
html{-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body{margin:0;background:var(--bg);color:var(--text);font-family:var(--font-family);font-size:var(--fs-16);line-height:var(--lh-base)}
a{color:var(--link);text-decoration:none}
a:hover{opacity:.9}
:focus-visible{outline:2px solid var(--accent-500);outline-offset:2px;border-radius:8px}

/* Scrollbar */
::-webkit-scrollbar{width:10px;height:10px}
::-webkit-scrollbar-thumb{background:var(--border-medium);border-radius:12px}
::-webkit-scrollbar-thumb:hover{background:var(--border-strong)}

/* ----- Layout ----- */
.m-app{
  min-height:100dvh;display:flex;flex-direction:column;
  background:
    radial-gradient(1200px 700px at 100% 0%, rgba(124,58,237,.08), transparent 70%),
    radial-gradient(900px 600px at 0% 100%, rgba(59,130,246,.06), transparent 65%),
    var(--bg);
}
.m-main{flex:1;min-height:0;display:flex;flex-direction:column}

/* Header */
.m-header{
  position:sticky;top:0;z-index:var(--z-sticky);
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  height:64px;padding:0 var(--sp-4);
  background:linear-gradient(180deg, var(--glass-strong), var(--glass));
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border-bottom:1px solid var(--separator)
}
.m-header__title{font-weight:700;font-size:var(--fs-20);letter-spacing:.1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.m-header__right{display:flex;align-items:center;gap:10px}
.m-icon-btn{
  width:38px;height:38px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;
  color:var(--text);background:var(--surface-2);border:1px solid var(--border-weak);
  box-shadow:var(--shadow-1);transition:transform var(--dur) var(--ease),background var(--dur) var(--ease),border-color var(--dur) var(--ease)
}
.m-icon-btn:hover{transform:translateY(-1px);background:var(--surface);border-color:var(--border-medium)}
.m-icon-btn:active{transform:translateY(0)}

/* Status Badges */
.badge{display:inline-flex;align-items:center;gap:8px;height:24px;padding:0 10px;border-radius:999px;font-size:var(--fs-12);font-weight:600;color:var(--muted);background:var(--surface-2);border:1px solid var(--border-weak)}
.badge--ok{color:#0BB885;background:rgba(16,185,129,.1);border-color:rgba(16,185,129,.2)}
.badge--warn{color:var(--warn);background:rgba(245,158,11,.12);border-color:rgba(245,158,11,.22)}
.badge--model{color:var(--text);background:rgba(255,255,255,.06)}
.badge--persona{background:rgba(124,58,237,.12);color:var(--accent-300);border-color:rgba(124,58,237,.25)}

/* ----- Chat ----- */
.chat-root{position:relative;display:flex;flex-direction:column;height:calc(100dvh - 64px)}
.chat-list{flex:1;min-height:0;overflow:auto;padding:var(--sp-5) var(--sp-3) var(--sp-4);display:flex;flex-direction:column;gap:var(--sp-3)}
.chat-list > *{max-width:min(740px, 100%);align-self:center}

/* Bubbles */
.bubble{
  border-radius:18px;box-shadow:var(--shadow-1);
  padding:var(--sp-3) var(--sp-4);
  background:var(--bot);color:var(--text);
  border:1px solid var(--border-weak);
  animation:fadein var(--dur) var(--ease);
  word-break:break-word;white-space:pre-wrap
}
.bubble--user{margin-left:auto;background:var(--user);color:#fff;border:none}
.bubble--bot{margin-right:auto;background:var(--bot)}
@keyframes fadein{from{opacity:.001;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* Markdown in Bubbles */
.bubble__txt{font-size:var(--fs-16);line-height:var(--lh-base)}
.bubble__txt p{margin:0 0 var(--sp-3)}
.bubble__txt p:last-child{margin-bottom:0}
.bubble__txt a{color:var(--link)}
.bubble__txt h1,.bubble__txt h2,.bubble__txt h3{font-weight:700;line-height:var(--lh-tight);margin:var(--sp-4) 0 var(--sp-2)}
.bubble__txt h1{font-size:var(--fs-28)} .bubble__txt h2{font-size:var(--fs-24)} .bubble__txt h3{font-size:var(--fs-20)}
.bubble__txt code{font-family:var(--font-mono);font-size:.92em;padding:1px 6px;border-radius:8px;background:var(--code-bg);border:1px solid var(--code-border)}
.bubble__txt pre{margin:var(--sp-3) 0;background:var(--code-bg);border:1px solid var(--code-border);border-radius:12px;overflow:auto}
.bubble__txt pre code{display:block;padding:var(--sp-3);line-height:1.55}
.bubble__txt blockquote{margin:var(--sp-3) 0;padding:var(--sp-3);border-left:4px solid var(--accent-600);background:var(--blockquote-bg);border-radius:12px}
.bubble__txt ul,.bubble__txt ol{margin:var(--sp-3) 0 var(--sp-3) var(--sp-5)}
.bubble__txt table{border-collapse:collapse;width:100%;margin:var(--sp-3) 0;font-size:var(--fs-14)}
.bubble__txt th,.bubble__txt td{border:1px solid var(--table-border);padding:8px 10px}
.bubble__txt th{background:rgba(255,255,255,.03);text-align:left}

/* Meta */
.bubble__meta{font-size:var(--fs-12);color:var(--muted);margin-top:var(--sp-2)}
.meta--r{text-align:right;opacity:.9}
.meta--l{text-align:left;opacity:.9}

/* Typing Indicator */
.bubble__dots{display:inline-flex;gap:8px;align-items:center;height:20px;padding:4px 0}
.bubble__dots .dot{width:8px;height:8px;border-radius:50%;background:var(--muted);animation:blink 1.2s infinite ease-in-out}
.bubble__dots .dot:nth-child(2){animation-delay:.15s}
.bubble__dots .dot:nth-child(3){animation-delay:.3s}
@keyframes blink{0%,80%,100%{opacity:.35}40%{opacity:1}}

/* Notices */
.notice{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  background: var(--surface-2);
  border:1px solid var(--border-weak);
  padding:10px 12px;margin:8px 10px 0;border-radius:12px;color:var(--muted)
}

/* ----- Composer ----- */
.composer{
  position:sticky;bottom:0;left:0;right:0;
  display:flex;align-items:flex-end;gap:10px;
  padding:12px 12px calc(12px + env(safe-area-inset-bottom)) 12px;
  background:linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--bg) 24%), var(--bg)
}
.composer__input{
  flex:1;min-height:44px;max-height:160px;resize:none;
  padding:10px 12px;border-radius:14px;color:var(--text);
  background:var(--surface-2);border:1px solid var(--border-medium);
  line-height:1.45;transition:border var(--dur) var(--ease), box-shadow var(--dur) var(--ease), background var(--dur) var(--ease)
}
.composer__input:focus{outline:none;border-color:var(--accent-600);box-shadow:0 0 0 3px color-mix(in oklab, var(--accent-600) 35%, transparent)}
.btn--send{
  width:48px;height:48px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;
  background:var(--accent-600);color:#fff;box-shadow:var(--shadow-1);
  transition:transform var(--dur) var(--ease), background var(--dur) var(--ease), box-shadow var(--dur) var(--ease)
}
.btn--send:hover{background:var(--accent-700);transform:translateY(-1px);box-shadow:var(--shadow-glow)}
.btn--send:active{background:var(--accent-800);transform:translateY(0)}

/* Buttons / Chips */
.btn{
  appearance:none;border:none;cursor:pointer;user-select:none;
  height:40px;padding:0 14px;border-radius:12px;
  background:var(--accent-600);color:#fff;font-weight:600;
  transition:background var(--dur) var(--ease), transform var(--dur) var(--ease), box-shadow var(--dur) var(--ease);
  box-shadow: var(--shadow-1)
}
.btn:hover{background:var(--accent-700)}
.btn:active{transform:translateY(1px);background:var(--accent-800)}
.btn[disabled]{opacity:.6;cursor:not-allowed;box-shadow:none}
.btn--ghost{background:transparent;color:var(--text);border:1px solid var(--border-medium);box-shadow:none}
.btn--ghost:hover{background:rgba(255,255,255,.06)}
.chip,.m-chip{
  display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;
  font-size:var(--fs-14);font-weight:600;background:var(--surface-2);border:1px solid var(--border-medium);color:var(--text);
  transition:background var(--dur) var(--ease), border-color var(--dur) var(--ease), transform var(--dur) var(--ease)
}
.chip:hover,.m-chip:hover{background:var(--surface);border-color:var(--border-strong)}
.chip.active,.m-chip.active{background:var(--accent-600);border-color:var(--accent-600);color:#fff}

/* ----- Settings Sheet (Drawer) ----- */
.sheet{position:fixed;inset:0;display:none;background:rgba(0,0,0,.35);backdrop-filter: blur(4px);transition:opacity var(--dur) var(--ease)}
.sheet--open{display:block}
.sheet__panel{
  position:absolute;right:0;top:0;height:100%;width:min(480px, 92vw);
  color:var(--text);background:linear-gradient(180deg, var(--surface), var(--surface-3));
  border-left:1px solid var(--separator);box-shadow:var(--shadow-3);
  transform:translateX(6%);transition:transform var(--dur) var(--ease)
}
.sheet--open .sheet__panel{transform:translateX(0)}
.sheet__header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--separator)}
.block{padding:14px;border-bottom:1px solid var(--separator)}
.block:last-child{border-bottom:none}
.block__title{font-size:var(--fs-16);font-weight:700;margin:0 0 10px}
.field{margin-bottom:10px}
.input,select,textarea{
  width:100%;height:44px;padding:10px 12px;border-radius:12px;color:var(--text);
  background:var(--surface-2);border:1px solid var(--border-medium);
  transition:border-color var(--dur) var(--ease), box-shadow var(--dur) var(--ease), background var(--dur) var(--ease)
}
.input::placeholder,textarea::placeholder{color:var(--muted)}
.input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent-600);box-shadow:0 0 0 3px color-mix(in oklab, var(--accent-600) 30%, transparent)}
select:disabled{opacity:.6}

/* ----- Dialog (Fallback) ----- */
.dialog{position:fixed;inset:0;background:rgba(0,0,0,.55);display:grid;place-items:center;padding:16px;z-index:var(--z-modal)}
.dialog__panel{
  width:min(90vw, 560px);max-height:85vh;background:var(--surface);
  border:1px solid var(--border-medium);border-radius:20px;box-shadow:var(--shadow-3);
  display:grid;grid-template-rows:auto 1fr auto
}
.dialog__header,.dialog__footer{padding:16px;border-bottom:1px solid var(--separator)}
.dialog__footer{border-top:1px solid var(--separator);border-bottom:none}
.dialog__content{overflow:auto;padding:16px}

/* ----- Toast (simple) ----- */
.toast{
  position:fixed;bottom:14px;right:14px;z-index:var(--z-toast);
  background:var(--surface-2);border:1px solid var(--border-medium);color:var(--text);
  box-shadow:var(--shadow-2);border-radius:12px;padding:10px 12px;min-width:220px
}
.toast--ok{border-color:rgba(16,185,129,.35)}
.toast--warn{border-color:rgba(245,158,11,.35)}
.toast--err{border-color:rgba(239,68,68,.35)}

/* ----- Skeletons ----- */
.skel{position:relative;overflow:hidden;background:rgba(255,255,255,.06);border-radius:10px}
.skel::after{
  content:"";position:absolute;inset:0;transform:translateX(-100%);
  background:linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
  animation:skel 1.3s infinite
}
@keyframes skel{to{transform:translateX(100%)}}

/* ----- Responsive ----- */
@media (max-width: 640px){
  .m-header{height:60px;padding:0 var(--sp-3)}
  .chat-list{padding:var(--sp-3) var(--sp-2)}
  .bubble{max-width:92%}
  .composer{padding:10px 10px calc(10px + env(safe-area-inset-bottom)) 10px}
  .sheet__panel{width:100%}
}

/* ----- Reduced Motion ----- */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important;transition:none !important;scroll-behavior:auto !important}
}
