/* =========================================
   Neon Nova Pro – Application Layer
   - Mobil-freundlicher, hochwertiger
   - Dezentere Glows, Noise gegen Banding
   - Safe-Area & iOS-Zoom-Fix
   ========================================= */

/* Base & Reset */
*,*::before,*::after{box-sizing:border-box}
html,body,#root{height:100%}
html{-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:var(--font-family);font-size:var(--fs-16);line-height:var(--lh-base);
  -webkit-tap-highlight-color: transparent;
}
a{color:var(--link);text-decoration:none}
a:hover{opacity:.9}
:focus-visible{outline:2px solid var(--secondary);outline-offset:2px;border-radius:8px}

/* Scrollbar */
::-webkit-scrollbar{width:10px;height:10px}
::-webkit-scrollbar-thumb{background:var(--border-medium);border-radius:12px}
::-webkit-scrollbar-thumb:hover{background:var(--border-strong)}

/* ===== Layout / Background ===== */
.m-app{
  position:relative;min-height:100dvh;display:flex;flex-direction:column;
  background:
    radial-gradient(900px 600px at 18% 0%, rgba(0,128,255,.14), transparent 60%),
    radial-gradient(820px 560px at 100% 100%, rgba(255,70,30,.12), transparent 65%),
    linear-gradient(180deg, #0B1B46 0%, #070D1E 55%, #060914 100%);
}
.m-app::before{
  /* Subtiles Noise gegen Gradient-Banding */
  content:"";position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image: var(--noise);
  opacity:.10;mix-blend-mode: soft-light;
}
.m-main{position:relative;z-index:1;flex:1;min-height:0;display:flex;flex-direction:column}

/* ===== Header ===== */
.m-header{
  position:sticky;top:0;z-index:var(--z-sticky);
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  height:64px;padding: calc(env(safe-area-inset-top) + var(--sp-1)) var(--sp-4) 0 var(--sp-4);
  background:linear-gradient(180deg, var(--glass-strong), var(--glass));
  backdrop-filter: blur(var(--blur-strength)); -webkit-backdrop-filter: blur(var(--blur-strength));
  border-bottom:1px solid var(--separator);
  box-shadow: inset 0 -1px 0 rgba(255,255,255,.04);
}
.m-header__title{
  font-weight:800;font-size:var(--fs-20);letter-spacing:.2px;
  background: linear-gradient(90deg, #EAF2FF 0%, #9BB6FF 100%);
  -webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.m-header__right{display:flex;align-items:center;gap:10px}
.m-icon-btn{
  width:38px;height:38px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  border:1px solid var(--border-weak);color:var(--text);
  box-shadow:var(--shadow-1);
  transition:transform var(--dur) var(--ease), border-color var(--dur) var(--ease)
}
.m-icon-btn:hover{transform:translateY(-1px);border-color:var(--border-medium)}
.m-icon-btn:active{transform:translateY(0)}

/* ===== Badges ===== */
.badge{display:inline-flex;align-items:center;gap:8px;height:24px;padding:0 10px;border-radius:999px;font-size:var(--fs-12);font-weight:600;color:var(--muted);background:rgba(255,255,255,.06);border:1px solid var(--border-weak)}
.badge--ok{color:#0BB885;background:rgba(16,185,129,.12);border-color:rgba(16,185,129,.28)}
.badge--warn{color:var(--warn);background:rgba(245,158,11,.14);border-color:rgba(245,158,11,.28)}
.badge--model{color:var(--text);background:rgba(0,0,0,.2)}
.badge--persona{color:#FFD0C2;background:rgba(255,77,46,.14);border-color:rgba(255,77,46,.30)}

/* ===== Chat ===== */
.chat-root{position:relative;display:flex;flex-direction:column;height:calc(100dvh - 64px)}
.chat-list{
  flex:1;min-height:0;overflow:auto;scroll-behavior:smooth;
  padding:var(--sp-5) var(--sp-3) var(--sp-4);
  display:flex;flex-direction:column;gap:var(--sp-3);
}
.chat-list > *{width:100%;max-width:min(72ch, 95vw);align-self:center}

/* Bubbles */
.bubble{
  position:relative;border-radius:18px;
  padding:var(--sp-3) var(--sp-4);
  border:1px solid var(--border-weak);
  box-shadow:var(--shadow-1);
  word-break:break-word;white-space:pre-wrap;
  transition: box-shadow var(--dur) var(--ease), background var(--dur) var(--ease), border-color var(--dur) var(--ease);
}
.bubble--bot{
  margin-right:auto;color:var(--text);
  background:
    radial-gradient(120px 80px at 18% 22%, rgba(0,155,255,.12), transparent 60%),
    radial-gradient(180px 120px at 82% 78%, rgba(0,60,200,.10), transparent 60%),
    var(--bot);
  border-color: rgba(0,160,255,.18);
  box-shadow: var(--glow-blue), var(--shadow-1);
}
.bubble--user{
  margin-left:auto;color:#fff;border:none;
  background: var(--user);
  box-shadow: var(--glow-red), var(--shadow-1);
}

/* Bubble-Gruppierung (Folgenachrichten enger & Corner-Adjust) */
.bubble--user + .bubble--user{ margin-top:6px; border-top-right-radius:10px }
.bubble--bot  + .bubble--bot { margin-top:6px; border-top-left-radius:10px  }

/* Markdown */
.bubble__txt{font-size:var(--fs-16);line-height:var(--lh-base);text-wrap:pretty}
.bubble__txt p{margin:0 0 var(--sp-3)}
.bubble__txt p:last-child{margin-bottom:0}
.bubble__txt a{color:var(--link)}
.bubble__txt h1,.bubble__txt h2,.bubble__txt h3{font-weight:700;line-height:var(--lh-tight);margin:var(--sp-4) 0 var(--sp-2)}
.bubble__txt h1{font-size:var(--fs-28)} .bubble__txt h2{font-size:var(--fs-24)} .bubble__txt h3{font-size:var(--fs-20)}
.bubble__txt code{
  font-family:var(--font-mono);font-size:.92em;padding:1px 6px;border-radius:8px;
  background:var(--code-bg);border:1px solid var(--code-border)
}
/* Lesbarer Inline-Code in oranger User-Blase */
.bubble--user .bubble__txt code{
  color:#EAF2FF;background:#1A2238;border:1px solid rgba(147,197,253,.28)
}
.bubble__txt pre{margin:var(--sp-3) 0;background:var(--code-bg);border:1px solid var(--code-border);border-radius:12px;overflow:auto}
.bubble__txt pre code{display:block;padding:var(--sp-3);line-height:1.55}
.bubble__txt blockquote{margin:var(--sp-3) 0;padding:var(--sp-3);border-left:4px solid var(--secondary);background:var(--blockquote-bg);border-radius:12px}
.bubble__txt ul,.bubble__txt ol{margin:var(--sp-3) 0 var(--sp-3) var(--sp-5)}
.bubble__txt table{border-collapse:collapse;width:100%;margin:var(--sp-3) 0;font-size:var(--fs-14)}
.bubble__txt th,.bubble__txt td{border:1px solid var(--table-border);padding:8px 10px}
.bubble__txt th{background:rgba(255,255,255,.03);text-align:left}

/* Meta */
.bubble__meta{font-size:var(--fs-12);color:var(--muted);margin-top:var(--sp-2)}
.meta--r{text-align:right;opacity:.9}
.meta--l{text-align:left;opacity:.9}

/* Typing */
.bubble__dots{display:inline-flex;gap:8px;align-items:center;height:20px;padding:4px 0}
.bubble__dots .dot{width:8px;height:8px;border-radius:50%;background:var(--muted);animation:blink 1.1s infinite ease-in-out}
.bubble__dots .dot:nth-child(2){animation-delay:.15s}
.bubble__dots .dot:nth-child(3){animation-delay:.3s}
@keyframes blink{0%,80%,100%{opacity:.35}40%{opacity:1}}
@media (prefers-reduced-motion: reduce){ .bubble__dots .dot{animation:none;opacity:.55} }

/* Notices */
.notice{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  background: var(--surface-2);
  border:1px solid var(--border-weak);
  padding:10px 12px;margin:8px 10px 0;border-radius:12px;color:var(--muted)
}

/* ===== Composer ===== */
.composer{
  position:sticky;bottom:0;left:0;right:0;
  display:flex;align-items:flex-end;gap:10px;
  padding:12px 12px max(12px, env(safe-area-inset-bottom));
  background: linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--bg) 22%), var(--bg);
}
.composer__input{
  flex:1;min-height:44px;max-height:160px;resize:none;
  padding:12px;border-radius:14px;color:var(--text);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border:1px solid var(--border-medium);
  line-height:1.45;font-size:16px; /* iOS: kein Zoom beim Fokus */
  transition:border var(--dur) var(--ease), box-shadow var(--dur) var(--ease)
}
.composer__input:focus{outline:none;border-color:var(--secondary);box-shadow:0 0 0 3px rgba(30,144,255,.28)}

.btn--send{
  width:52px;height:52px;border-radius:50%;
  display:inline-flex;align-items:center;justify-content:center;
  background:linear-gradient(140deg, var(--accent-600), var(--accent-800));
  color:#fff;border:none;box-shadow: var(--glow-red), var(--shadow-1);
  transition:transform var(--dur) var(--ease)
}
.btn--send:hover{transform:translateY(-1px)}
.btn--send:active{transform:translateY(0)}

/* Generic Buttons / Chips */
.btn{
  appearance:none;border:none;cursor:pointer;user-select:none;
  height:44px;padding:0 16px;border-radius:12px;
  background:linear-gradient(140deg, var(--accent-600), var(--accent-800));
  color:#fff;font-weight:700;box-shadow:var(--shadow-1);
  transition:transform var(--dur) var(--ease)
}
.btn:hover{transform:translateY(-1px)} .btn:active{transform:translateY(0)}
.btn[disabled]{opacity:.6;cursor:not-allowed;box-shadow:none}
.btn--ghost{background:transparent;color:var(--text);border:1px solid var(--border-medium);box-shadow:none}
.btn--ghost:hover{background:rgba(255,255,255,.06)}

.chip,.m-chip{
  display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;
  font-size:var(--fs-14);font-weight:600;
  background:rgba(255,255,255,.06);
  border:1px solid var(--border-medium);color:var(--text);
}
.chip.active,.m-chip.active{
  background:linear-gradient(140deg, var(--accent-600), var(--accent-800));
  color:#fff;border-color:transparent;
}

/* ===== Settings Sheet ===== */
.sheet{position:fixed;inset:0;display:none;background:rgba(0,0,0,.35);backdrop-filter: blur(calc(var(--blur-strength) - 2px))}
.sheet--open{display:block}
.sheet__panel{
  position:absolute;right:0;top:0;height:100%;width:min(480px, 92vw);
  color:var(--text);
  background:
    radial-gradient(580px 380px at 100% 0%, rgba(0,128,255,.10), transparent 60%),
    radial-gradient(480px 300px at 0% 100%, rgba(255,70,30,.10), transparent 60%),
    linear-gradient(180deg, var(--surface), var(--surface-3));
  border-left:1px solid var(--separator);box-shadow:var(--shadow-3);
  transform:translateX(6%);transition:transform var(--dur) var(--ease)
}
.sheet--open .sheet__panel{transform:translateX(0)}
.sheet__header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--separator)}
.block{padding:14px;border-bottom:1px solid var(--separator)}
.block:last-child{border-bottom:none}
.block__title{font-size:var(--fs-16);font-weight:700;margin:0 0 10px}
.field{margin-bottom:10px}
.input,select,textarea{
  width:100%;height:44px;padding:10px 12px;border-radius:12px;color:var(--text);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border:1px solid var(--border-medium);
  transition:border-color var(--dur) var(--ease), box-shadow var(--dur) var(--ease)
}
.input::placeholder,textarea::placeholder{color:var(--muted)}
.input:focus,select:focus,textarea:focus{outline:none;border-color:var(--secondary);box-shadow:0 0 0 3px rgba(30,144,255,.24)}
select:disabled{opacity:.6}

/* Dialog / Toast (falls verwendet) */
.dialog{position:fixed;inset:0;background:rgba(0,0,0,.55);display:grid;place-items:center;padding:16px;z-index:var(--z-modal)}
.dialog__panel{width:min(90vw,560px);max-height:85vh;background:var(--surface);border:1px solid var(--border-medium);border-radius:20px;box-shadow:var(--shadow-3);display:grid;grid-template-rows:auto 1fr auto}
.dialog__header,.dialog__footer{padding:16px;border-bottom:1px solid var(--separator)}
.dialog__footer{border-top:1px solid var(--separator);border-bottom:none}
.dialog__content{overflow:auto;padding:16px}
.toast{position:fixed;bottom:14px;right:14px;z-index:var(--z-toast);background:var(--surface-2);border:1px solid var(--border-medium);color:var(--text);box-shadow:var(--shadow-2);border-radius:12px;padding:10px 12px;min-width:220px}

/* ===== Mobile optimiert ===== */
@media (max-width: 640px){
  .m-header{height:60px;padding: calc(env(safe-area-inset-top) + 4px) var(--sp-3) 0 var(--sp-3)}
  .chat-list{padding:var(--sp-3) var(--sp-2)}
  .bubble{max-width:94%}
  .composer{padding:10px 10px max(10px, env(safe-area-inset-bottom))}
  .btn--send{width:56px;height:56px}
  .m-icon-btn{width:44px;height:44px}
  .sheet__panel{width:100%}
}

/* Reduced Motion – alles ruhig */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important;transition:none !important;scroll-behavior:auto !important}
}
