/* ===== Base ===== */
*,*::before,*::after{box-sizing:border-box}
html,body,#root{height:100%}
html{-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body{margin:0;background:var(--bg);color:var(--text);font-family:var(--font-family);font-size:var(--fs-16);line-height:var(--lh-base);-webkit-tap-highlight-color:transparent}
a{color:var(--link);text-decoration:none}
a:hover{opacity:.9}
:focus-visible{outline:2px solid hsl(var(--ring));outline-offset:2px;border-radius:8px}

/* Scrollbar */
::-webkit-scrollbar{width:10px;height:10px}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,.15);border-radius:12px}
::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.28)}

/* ===== Layout / Background ===== */
.m-app{position:relative;min-height:100dvh;display:flex;flex-direction:column;background:
  radial-gradient(900px 600px at 18% 0%, rgba(245,158,11,.14), transparent 60%),
  radial-gradient(820px 560px at 100% 100%, rgba(245,158,11,.10), transparent 65%),
  linear-gradient(180deg, #0B0F14 0%, #070D1E 55%, #060914 100%)}
.m-app::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:0;background-image:var(--noise);opacity:.10;mix-blend-mode:soft-light}
.m-main{position:relative;z-index:1;flex:1;min-height:0;display:flex;flex-direction:column}

/* ===== Header ===== */
.m-header{position:sticky;top:0;z-index:var(--z-sticky);display:flex;align-items:center;justify-content:space-between;gap:12px;height:64px;padding:calc(env(safe-area-inset-top) + var(--sp-1)) var(--sp-4) 0 var(--sp-4);background:linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,.18));backdrop-filter:blur(var(--blur-strength));-webkit-backdrop-filter:blur(var(--blur-strength));border-bottom:1px solid var(--separator)}
.m-header__title{font-weight:800;font-size:var(--fs-20);letter-spacing:.2px;background:linear-gradient(90deg, #FEF3C7 0%, #FCD34D 100%);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.m-header__right{display:flex;align-items:center;gap:10px}
.m-icon-btn{width:38px;height:38px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.12);color:var(--text);box-shadow:var(--shadow-1);transition:transform .18s ease,border-color .18s ease}
.m-icon-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.24)}
.m-icon-btn:active{transform:translateY(0)}
.badge{display:inline-flex;align-items:center;gap:8px;height:24px;padding:0 10px;border-radius:999px;font-size:var(--fs-12);font-weight:600;color:var(--muted-text);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12)}
.badge--persona{color:#FFE7BF;background:rgba(245,158,11,.14);border-color:rgba(245,158,11,.30)}

/* ===== Chat ===== */
.chat-root{position:relative;display:flex;flex-direction:column;height:calc(100dvh - 64px)}
.chat-list{flex:1;min-height:0;overflow:auto;scroll-behavior:smooth;padding:var(--sp-5) var(--sp-3) var(--sp-4);display:flex;flex-direction:column;gap:var(--sp-3)}
.chat-list > *{width:100%;max-width:min(72ch, 95vw);align-self:center}

/* Tages-Divider */
.day-divider{position:relative;display:flex;align-items:center;justify-content:center;color:var(--muted-text);font-size:var(--fs-12);margin:8px 0}
.day-divider::before,.day-divider::after{content:"";flex:1;height:1px;background:rgba(255,255,255,.08)}
.day-divider span{padding:0 10px}

/* Bubbles */
.bubble{position:relative;border-radius:18px;padding:var(--sp-3) var(--sp-4);border:1px solid rgba(255,255,255,.10);box-shadow:var(--shadow-1);word-break:break-word;white-space:pre-wrap;transition:box-shadow .18s ease,background .18s ease,border-color .18s ease}
.bubble--bot{margin-right:auto;color:var(--text);background:
  radial-gradient(120px 80px at 18% 22%, rgba(245,158,11,.12), transparent 60%),
  radial-gradient(180px 120px at 82% 78%, rgba(245,158,11,.10), transparent 60%),
  var(--bot);border-color:rgba(245,158,11,.18);box-shadow:var(--glow-amber),var(--shadow-1)}
.bubble--user{margin-left:auto;color:#fff;border:none;background:var(--user);box-shadow:var(--glow-amber),var(--shadow-1)}
.bubble--user + .bubble--user{margin-top:6px;border-top-right-radius:10px}
.bubble--bot + .bubble--bot{margin-top:6px;border-top-left-radius:10px}

/* Markdown */
.bubble__txt{font-size:var(--fs-16);line-height:var(--lh-base);text-wrap:pretty}
.bubble__txt p{margin:0 0 var(--sp-3)}
.bubble__txt p:last-child{margin-bottom:0}
.bubble__txt a{color:var(--link)}
.bubble__txt h1,.bubble__txt h2,.bubble__txt h3{font-weight:700;line-height:var(--lh-tight);margin:var(--sp-4) 0 var(--sp-2)}
.bubble__txt h1{font-size:var(--fs-28)}.bubble__txt h2{font-size:var(--fs-24)}.bubble__txt h3{font-size:var(--fs-20)}
.bubble__txt code{font-family:var(--font-mono);font-size:.92em;padding:1px 6px;border-radius:8px;background:var(--code-bg);border:1px solid var(--code-border)}
.bubble--user .bubble__txt code{color:#fff;background:#282828;border:1px solid rgba(245,158,11,.28)}
.bubble__txt pre{margin:var(--sp-3) 0;background:var(--code-bg);border:1px solid var(--code-border);border-radius:12px;overflow:auto}
.bubble__txt pre code{display:block;padding:var(--sp-3);line-height:1.55}
.bubble__txt blockquote{margin:var(--sp-3) 0;padding:var(--sp-3);border-left:4px solid var(--secondary);background:var(--blockquote-bg);border-radius:12px}
.bubble__txt ul,.bubble__txt ol{margin:var(--sp-3) 0 var(--sp-3) var(--sp-5)}
.bubble__txt table{border-collapse:collapse;width:100%;margin:var(--sp-3) 0;font-size:var(--fs-14)}
.bubble__txt th,.bubble__txt td{border:1px solid var(--table-border);padding:8px 10px}

/* Meta + Toolbar */
.bubble__meta{font-size:var(--fs-12);color:var(--muted-text);margin-top:var(--sp-2)}
.meta--r{text-align:right;opacity:.9}
.meta--l{text-align:left;opacity:.9}
.bubble__toolbar{display:flex;gap:8px;margin-top:6px}

/* Typing Indicator */
.bubble__dots{display:inline-flex;gap:8px;align-items:center;height:20px;padding:4px 0}
.bubble__dots .dot{width:8px;height:8px;border-radius:50%;background:var(--muted-text);animation:blink 1.1s infinite ease-in-out}
.bubble__dots .dot:nth-child(2){animation-delay:.15s}
.bubble__dots .dot:nth-child(3){animation-delay:.3s}
@keyframes blink{0%,80%,100%{opacity:.35}40%{opacity:1}}
@media (prefers-reduced-motion: reduce){ .bubble__dots .dot{animation:none;opacity:.55} }

/* Notices */
.notice{display:flex;align-items:center;justify-content:space-between;gap:12px;background:var(--surface-2);border:1px solid rgba(255,255,255,.12);padding:10px 12px;margin:8px 10px 0;border-radius:12px;color:var(--muted-text)}

/* ===== Composer ===== */
.composer{position:sticky;bottom:0;left:0;right:0;display:flex;align-items:flex-end;gap:10px;padding:12px 12px max(12px, env(safe-area-inset-bottom));background:linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--bg) 22%), var(--bg)}
.composer__input{flex:1;min-height:44px;max-height:160px;resize:none;padding:12px;border-radius:14px;color:var(--text);background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.18);line-height:1.45;font-size:16px;transition:border .18s ease, box-shadow .18s ease}
.composer__input:focus{outline:none;border-color:hsl(var(--ring));box-shadow:0 0 0 3px rgba(245,158,11,.24)}
.btn{appearance:none;border:none;cursor:pointer;user-select:none;height:44px;padding:0 16px;border-radius:12px;background:linear-gradient(140deg, var(--accent-600), var(--accent-800));color:#fff;font-weight:700;box-shadow:var(--shadow-1);transition:transform .18s ease}
.btn:hover{transform:translateY(-1px)} .btn:active{transform:translateY(0)}
.btn[disabled]{opacity:.6;cursor:not-allowed;box-shadow:none}
.btn--ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.18);box-shadow:none}
.btn--send{width:52px;height:52px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:linear-gradient(140deg, var(--accent-600), var(--accent-800));color:#fff;border:none;box-shadow:var(--glow-amber),var(--shadow-1);transition:transform .18s ease}
.btn--send:hover{transform:translateY(-1px)} .btn--send:active{transform:translateY(0)}

/* ===== Settings Sheet ===== */
.sheet{position:fixed;inset:0;z-index:var(--z-over);background:rgba(0,0,0,.35);-webkit-backdrop-filter:blur(calc(var(--blur-strength) - 2px));backdrop-filter:blur(calc(var(--blur-strength) - 2px));opacity:0;pointer-events:none;transition:opacity .18s ease}
.sheet--open{opacity:1;pointer-events:auto}
.sheet__panel{position:absolute;right:0;top:0;height:100%;width:min(480px,92vw);z-index:var(--z-modal);color:var(--text);background:
  radial-gradient(580px 380px at 100% 0%, rgba(245,158,11,.10), transparent 60%),
  radial-gradient(480px 300px at 0% 100%, rgba(245,158,11,.10), transparent 60%),
  linear-gradient(180deg, var(--surface), var(--surface-3));
border-left:1px solid var(--separator);box-shadow:var(--shadow-3);transform:translateX(8%);transition:transform .18s ease}
.sheet--open .sheet__panel{transform:translateX(0)}
.sheet__header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--separator)}
.sheet__title{font-weight:700}
.sheet__tabs{display:flex;border-bottom:1px solid var(--separator)}
.sheet__tabs button{flex:1;padding:10px;border:none;background:transparent;color:var(--text);font-weight:600;cursor:pointer}
.sheet__tabs .tab-active{color:hsl(var(--accent));border-bottom:2px solid hsl(var(--accent))}
.sheet__content{overflow:auto;-webkit-overflow-scrolling:touch;padding:16px;display:flex;flex-direction:column;gap:16px}
.block{padding:14px;border:1px solid rgba(255,255,255,.18);border-radius:14px;background:var(--surface-2)}
.block__title{font-size:var(--fs-16);font-weight:700;margin:0 0 10px}
.field{display:flex;flex-direction:column;gap:8px}
.input,select,textarea{width:100%;height:44px;padding:10px 12px;border-radius:12px;color:var(--text);background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.18);transition:border-color .18s ease, box-shadow .18s ease}
select{appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%239AA4B2' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px}
.input::placeholder,textarea::placeholder{color:var(--muted-text)}
.input:focus,select:focus,textarea:focus{outline:none;border-color:hsl(var(--ring));box-shadow:0 0 0 3px rgba(245,158,11,.24)}
.sheet__footer{display:flex;justify-content:flex-end;gap:12px;padding:16px}

/* ===== Mobile ===== */
@media (max-width:640px){
  .m-header{height:60px;padding:calc(env(safe-area-inset-top) + 4px) var(--sp-3) 0 var(--sp-3)}
  .chat-list{padding:var(--sp-3) var(--sp-2)}
  .bubble{max-width:94%}
  .composer{padding:10px 10px max(10px, env(safe-area-inset-bottom))}
  .btn--send{width:56px;height:56px}
  .m-icon-btn{width:44px;height:44px}
  .sheet__panel{width:100%}
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important;transition:none !important;scroll-behavior:auto !important}
}
