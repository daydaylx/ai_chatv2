/* ==== Reset & Base ==== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { height:100%; -webkit-text-size-adjust:100%; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
body { height:100%; background:var(--bg); color:var(--text); font-family:var(--font-family); font-size:var(--font-size-base); line-height:var(--line-height-base); transition: background-color var(--duration-slow) var(--easing); }
#root { height:100%; }
a { color:inherit; text-decoration:none; }

/* Focus */
:focus-visible { outline:2px solid var(--accent); outline-offset:2px; border-radius: var(--radius-sm); }

/* Scrollbar */
::-webkit-scrollbar { width:8px; height:8px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-medium); border-radius: var(--radius-full); transition: background var(--duration-fast) var(--easing); }
::-webkit-scrollbar-thumb:hover { background: var(--border-strong); }

/* Utilities */
.sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
.container { max-width: 680px; margin: 0 auto; padding: 0 var(--space-4); }
.row { display:flex; gap:var(--space-2); align-items:center; }
.mute { color: var(--muted); }

/* ==== App Frame ==== */
.m-app { display:grid; grid-template-rows:auto 1fr; height:100%; background:var(--bg); }
.m-main { height:100%; overflow:hidden; position:relative; }

/* ==== Header ==== */
.m-header {
  height:60px; display:flex; align-items:center; justify-content:space-between;
  padding:0 var(--space-4);
  background:var(--surface);
  border-bottom:1px solid var(--separator);
  backdrop-filter: blur(10px);
  position:sticky; top:0; z-index: var(--z-sticky);
  transition: background-color var(--duration-normal) var(--easing);
}
.m-header__title {
  font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); letter-spacing:-0.02em;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  background: linear-gradient(135deg, var(--text) 0%, var(--muted) 100%);
  -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
}
.m-header__right { display:flex; align-items:center; gap: var(--space-2); }

/* Badges */
.badge { font-size:var(--font-size-xs); font-weight:var(--font-weight-medium); padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); background: var(--border-weak); color: var(--muted); border:1px solid var(--border-medium); transition: all var(--duration-fast) var(--easing); }
.badge--warn { background: rgba(245, 158, 11, .1); color: var(--warn); border-color: rgba(245, 158, 11, .2); }

/* Icon Button */
.m-icon-btn {
  width:36px; height:36px; display:grid; place-items:center;
  border-radius: var(--radius-input); background: var(--border-weak);
  border:1px solid var(--border-medium); color: var(--text); cursor:pointer;
  transition: all var(--duration-fast) var(--easing);
}
.m-icon-btn:hover:not(:disabled){ background: var(--border-medium); border-color: var(--border-strong); transform: translateY(-1px); }
.m-icon-btn:active:not(:disabled){ transform: translateY(0); }
.m-icon-btn svg { width:20px; height:20px; }

/* Status Dots + Aliasse */
.dot, .m-dot { width:8px; height:8px; border-radius: var(--radius-full); display:inline-block; transition: all var(--duration-normal) var(--easing); }
.dot--ok, .m-dot--ok { background: var(--success); box-shadow: 0 0 8px rgba(16,185,129,.4); }
.dot--bad, .m-dot--warn { background: var(--error); box-shadow: 0 0 8px rgba(239,68,68,.4); }

/* ==== Chat Layout ==== */
.chat-root { height:100%; display:grid; grid-template-rows: 1fr auto; }

/* Notice (optional) */
.notice {
  display:flex; gap:var(--space-3); align-items:center; justify-content:center;
  padding: var(--space-3); background: rgba(245,158,11,.1); color: var(--warn);
  font-size: var(--font-size-sm); border-bottom:1px solid rgba(245,158,11,.2);
  animation: slideDown var(--duration-slow) var(--easing);
}
@keyframes slideDown { from{transform:translateY(-100%); opacity:0;} to{transform:translateY(0); opacity:1;} }

/* Chat List */
.chat-list {
  overflow-y:auto; padding: var(--space-5) var(--space-3);
  display:flex; flex-direction:column; gap: var(--space-3); align-items:center;
}
.chat-list > * { width:100%; max-width:680px; }

/* ==== Bubbles ==== */
.bubble {
  padding: var(--space-3) var(--space-4);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-1);
  animation: fadeInUp var(--duration-normal) var(--easing);
  transition: all var(--duration-fast) var(--easing);
  max-width:85%;
  background: var(--bot); color: var(--text);
  border:1px solid var(--border-weak);
}
@keyframes fadeInUp { from{opacity:0; transform:translateY(8px);} to{opacity:1; transform:translateY(0);} }

.bubble--bot { align-self:flex-start; border-top-left-radius: var(--space-1); }
.bubble--user { align-self:flex-end; background: var(--user); color:#fff; border:none; border-top-right-radius: var(--space-1); }

.bubble__txt { white-space:pre-wrap; word-break:break-word; font-size: var(--font-size-base); line-height: var(--line-height-base); }
.bubble__txt p { margin-bottom: var(--space-2); }
.bubble__txt p:last-child { margin-bottom:0; }

.bubble__meta { font-size: var(--font-size-xs); opacity:.7; margin-top: var(--space-2); font-weight: var(--font-weight-medium); }
.meta--r { text-align:right; } .meta--l { text-align:left; }

/* Typing Indicator */
.bubble__dots { display:inline-flex; gap: var(--space-2); align-items:center; height:20px; padding: var(--space-1) 0; }
.bubble__dots .dot { width:8px; height:8px; background: var(--muted); animation: pulse 1.4s infinite ease-in-out; box-shadow:none; }
.bubble__dots .dot:nth-child(2){ animation-delay:.16s; } .bubble__dots .dot:nth-child(3){ animation-delay:.32s; }
@keyframes pulse { 0%,80%,100%{opacity:.3; transform:scale(.8);} 40%{opacity:1; transform:scale(1);} }
@media (prefers-reduced-motion: reduce){ .bubble__dots .dot { animation:none; opacity:.6; } }

/* ==== Composer ==== */
.composer {
  display:grid; grid-template-columns: 1fr auto; gap: var(--space-2);
  padding: var(--space-3); background: var(--surface); border-top:1px solid var(--separator);
  box-shadow: var(--shadow-2); position:sticky; bottom:0; z-index: var(--z-sticky);
}
.composer__input {
  width:100%; min-height:44px; max-height:120px; padding: var(--space-3);
  border-radius: var(--radius-input); border:1px solid var(--border-medium);
  background: var(--bg); color: var(--text); font-size: var(--font-size-base); font-family: var(--font-family);
  line-height: var(--line-height-base); resize:none; transition: all var(--duration-fast) var(--easing);
}
.composer__input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(124,58,237,.10); }
.composer__input:disabled { opacity:.5; cursor:not-allowed; }
.composer__input::placeholder { color: var(--muted); opacity:.7; }
.btn--send {
  width:48px; height:48px; border-radius: var(--radius-full);
  display:grid; place-items:center; background: var(--accent); color:#fff; box-shadow: var(--shadow-1);
}
.btn--send:hover:not(:disabled){ background: var(--accent-hover); transform: scale(1.05); box-shadow: var(--shadow-glow); }
.btn--send:active:not(:disabled){ transform: scale(.95); }

/* ==== Buttons ==== */
.btn {
  height:44px; padding:0 var(--space-5); border-radius: var(--radius-btn);
  background: var(--accent); color:#fff; border:none;
  font-size: var(--font-size-base); font-weight: var(--font-weight-semibold); font-family: var(--font-family);
  cursor:pointer; transition: all var(--duration-fast) var(--easing);
  display:inline-flex; align-items:center; justify-content:center; gap: var(--space-2); white-space:nowrap;
}
.btn:hover:not(:disabled){ background: var(--accent-hover); transform: translateY(-1px); box-shadow: var(--shadow-1); }
.btn:active:not(:disabled){ background: var(--accent-press); transform: translateY(0); }
.btn:disabled { opacity:.5; cursor:not-allowed; }
.btn--ghost { background: transparent; color: var(--text); border:1px solid var(--border-medium); }
.btn--ghost:hover:not(:disabled){ background: var(--border-weak); border-color: var(--border-strong); }

/* ==== Chips (inkl. Alias f√ºr .m-chip) ==== */
.chip, .m-chip {
  display:inline-flex; align-items:center; gap: var(--space-2);
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-full);
  font-size: var(--font-size-sm); font-weight: var(--font-weight-medium);
  background: var(--border-weak); border:1px solid var(--border-medium); color: var(--text);
  cursor:pointer; transition: all var(--duration-fast) var(--easing);
}
.chip:hover, .m-chip:hover { background: var(--border-medium); border-color: var(--border-strong); }
.chip.active, .m-chip.active { background: var(--accent); color:#fff; border-color: var(--accent); }

/* ==== Settings Sheet ==== */
.sheet { position:fixed; inset:0; background: rgba(0,0,0,.4); opacity:0; pointer-events:none; transition: opacity var(--duration-normal) var(--easing); z-index: var(--z-overlay); backdrop-filter: blur(4px); }
.sheet--open { opacity:1; pointer-events:auto; }
.sheet__panel { position:absolute; right:0; top:0; bottom:0; width:min(90vw, 400px); background: var(--bg); border-left:1px solid var(--separator); transform: translateX(100%); transition: transform var(--duration-slow) var(--easing); display:grid; grid-template-rows:auto 1fr auto; gap:0; box-shadow: var(--shadow-3); }
.sheet--open .sheet__panel { transform: translateX(0); }
.sheet__header { display:flex; align-items:center; justify-content:space-between; padding: var(--space-4); border-bottom:1px solid var(--separator); background: var(--surface); }
.sheet__title { font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); letter-spacing:-0.02em; }
.sheet__content { overflow-y:auto; padding: var(--space-4); display:flex; flex-direction:column; gap: var(--space-5); }
.sheet__safe { height: env(safe-area-inset-bottom); background: var(--surface); }

/* ==== Blocks & Fields ==== */
.block { padding: var(--space-4); border:1px solid var(--border-medium); border-radius: var(--radius); background: var(--surface); display:flex; flex-direction:column; gap: var(--space-3); }
.block__title { font-size: var(--font-size-sm); font-weight: var(--font-weight-semibold); color: var(--muted); text-transform: uppercase; letter-spacing:.05em; margin-bottom: var(--space-2); }
.field { display:flex; flex-direction:column; gap: var(--space-2); }

/* ==== Inputs ==== */
.input {
  width:100%; height:44px; padding:0 var(--space-3);
  border-radius: var(--radius-input); border:1px solid var(--border-medium);
  background: var(--bg); color: var(--text); font-size: var(--font-size-base); font-family: var(--font-family);
  transition: all var(--duration-fast) var(--easing);
}
.input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(124,58,237,.10); }
.input:disabled { opacity:.5; cursor:not-allowed; }
.input::placeholder { color: var(--muted); }
select.input { cursor:pointer; appearance:none; background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%239AA4B2' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right var(--space-3) center; padding-right: var(--space-10); }
textarea.input { min-height:100px; padding: var(--space-3); resize: vertical; }

/* ==== Presets List (Settings) ==== */
.preset-list { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap: var(--space-2); }
.preset { border:1px solid var(--border-medium); border-radius: var(--radius); background: var(--bg); transition: all var(--duration-fast) var(--easing); }
.preset:hover { border-color: var(--border-strong); background: var(--surface); }
.preset--active { border-color: var(--accent); background: rgba(124,58,237,.05); }
.preset__row { display:flex; gap: var(--space-3); padding: var(--space-3); align-items:flex-start; cursor:pointer; }
.preset__row input[type="radio"] { margin-top:2px; accent-color: var(--accent); }
.preset__body { display:flex; flex-direction:column; gap: var(--space-1); flex:1; }
.preset__name { font-weight: var(--font-weight-semibold); font-size: var(--font-size-base); color: var(--text); }
.preset__desc { font-size: var(--font-size-sm); color: var(--muted); line-height: var(--line-height-tight); }

/* ==== Responsive ==== */
@media (max-width: 640px){
  .m-header { height:56px; padding:0 var(--space-3); }
  .chat-list { padding: var(--space-3) var(--space-2); }
  .bubble { max-width:92%; }
  .composer { padding: var(--space-2); }
  .sheet__panel { width:100%; }
}

/* Touch targets */
@media (hover:none) and (pointer:coarse){
  .btn { min-height:48px; }
  .input { min-height:48px; }
  .m-icon-btn { width:44px; height:44px; }
}

/* Print */
@media print{
  .m-header, .composer, .sheet, .dialog { display:none !important; }
  .chat-list { padding:0; gap: var(--space-2); }
  .bubble { box-shadow:none; border:1px solid var(--border-medium); }
}
